from fastapi import FastAPI, HTTPException\nfrom sqlalchemy import create_engine, Column, Integer, String, Boolean\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy.orm import sessionmaker, Session\nfrom pydantic import BaseModel\n\n# Database setup\nSQLALCHEMY_DATABASE_URL = "sqlite:///./tasks.db"\nengine = create_engine(SQLALCHEMY_DATABASE_URL)\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)\nBase = declarative_base()\n\n# Task model\nclass Task(Base):\n    __tablename__ = 'tasks'\n\n    id = Column(Integer, primary_key=True, index=True)\n    title = Column(String, index=True)\n    description = Column(String)\n    completed = Column(Boolean, default=False)\n\n# Pydantic model\nclass TaskCreate(BaseModel):\n    title: str\n    description: str = None\n    completed: bool = False\n\nclass TaskUpdate(BaseModel):\n    title: str = None\n    description: str = None\n    completed: bool = None\n\n# Create the database tables if they don't exist\nBase.metadata.create_all(bind=engine)\n\napp = FastAPI()\n\n\n@app.post("/tasks", response_model=TaskCreate)\ndef create_task(task: TaskCreate):\n    db: Session = SessionLocal()\n    db_task = Task(**task.dict())\n    db.add(db_task)\n    db.commit()\n    db.refresh(db_task)\n    db.close()\n    return db_task\n\n@app.get("/tasks")\ndef get_tasks():\n    db: Session = SessionLocal()\n    tasks = db.query(Task).all()\n    db.close()\n    return tasks\n\n@app.get("/tasks/{task_id}")\ndef get_task(task_id: int):\n    db: Session = SessionLocal()\n    task = db.query(Task).filter(Task.id == task_id).first()\n    db.close()\n    if task is None:\n        raise HTTPException(status_code=404, detail="Task not found")\n    return task\n\n@app.put("/tasks/{task_id}")\ndef update_task(task_id: int, task: TaskUpdate):\n    db: Session = SessionLocal()\n    db_task = db.query(Task).filter(Task.id == task_id).first()\n    if db_task is None:\n        db.close()\n        raise HTTPException(status_code=404, detail="Task not found")\n    for key, value in task.dict(exclude_unset=True).items():\n        setattr(db_task, key, value)\n    db.commit()\n    db.refresh(db_task)\n    db.close()\n    return db_task\n\n@app.delete("/tasks/{task_id}")\ndef delete_task(task_id: int):\n    db: Session = SessionLocal()\n    db_task = db.query(Task).filter(Task.id == task_id).first()\n    if db_task is None:\n        db.close()\n        raise HTTPException(status_code=404, detail="Task not found")\n    db.delete(db_task)\n    db.commit()\n    db.close()\n    return {"detail": "Task deleted"}